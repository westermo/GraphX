<UserControl x:Class="ShowcaseApp.Avalonia.Pages.PerformanceGraph"
             xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:exampleModels="clr-namespace:ShowcaseApp.Avalonia.ExampleModels"
             xmlns:zoomControl="clr-namespace:Westermo.GraphX.Controls.Controls.ZoomControl;assembly=Westermo.GraphX.Controls.Avalonia"
             mc:Ignorable="d"
             d:DesignHeight="500" d:DesignWidth="800">
    <UserControl.Styles>
        <StyleInclude Source="/Templates/GeneralTemplate.axaml" />
    </UserControl.Styles>
    
    <Grid RowDefinitions="Auto,*">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" MinWidth="100" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="220" />
        </Grid.ColumnDefinitions>

        <Border CornerRadius="2" BorderBrush="{DynamicResource ButtonBorder}"
                Background="{DynamicResource ButtonBackground}" Margin="2" BorderThickness="1">
            <TextBlock Margin="4" TextWrapping="Wrap" TextAlignment="Center"
                       Text="Performance Optimizations Demo - Test viewport culling, geometry caching, and LOD with large graphs (1000+ nodes)" />
        </Border>

        <Border Grid.Row="1" Grid.Column="0" BorderBrush="{DynamicResource ButtonBorder}" BorderThickness="1" Margin="2">
            <zoomControl:ZoomControl x:Name="zoomCtrl" Foreground="{DynamicResource ButtonText}">
                <exampleModels:GraphAreaExample x:Name="graphArea" />
            </zoomControl:ZoomControl>
        </Border>

        <!-- Stats overlay -->
        <Border Name="statsPanel" Grid.Row="1" Grid.Column="0" 
                CornerRadius="4" BorderBrush="{DynamicResource ButtonBorder}"
                BorderThickness="1" HorizontalAlignment="Left" VerticalAlignment="Top"
                Background="{DynamicResource ButtonBackground}" Margin="10" Padding="8" Opacity="0.9">
            <StackPanel>
                <TextBlock Name="txtStats" Text="Stats: Loading..." FontFamily="Consolas" FontSize="11"/>
            </StackPanel>
        </Border>

        <!-- Loading indicator -->
        <Border Name="loader" IsVisible="False" CornerRadius="4" BorderBrush="{DynamicResource ButtonBorder}"
                BorderThickness="1" HorizontalAlignment="Center" VerticalAlignment="Center"
                Background="{DynamicResource ButtonBackground}" Grid.Row="1" Grid.Column="0">
            <Label VerticalAlignment="Center" Content="Generating graph..." Margin="10" />
        </Border>

        <GridSplitter VerticalAlignment="Stretch" Width="2" Grid.Row="0" Grid.RowSpan="2" Grid.Column="1" />

        <ScrollViewer Grid.Column="2" Grid.Row="0" Grid.RowSpan="2">
            <StackPanel Margin="4">
                <TextBlock Text="PERFORMANCE SETTINGS" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                
                <!-- Graph Size -->
                <Expander IsExpanded="True" Header="Graph Size">
                    <StackPanel Margin="4">
                        <DockPanel Margin="2">
                            <TextBlock Text="Nodes:" DockPanel.Dock="Left" VerticalAlignment="Center" Width="60"/>
                            <TextBox Name="txtNodeCount" Text="500" Width="60" HorizontalAlignment="Left"/>
                        </DockPanel>
                        <DockPanel Margin="2">
                            <TextBlock Text="Edges:" DockPanel.Dock="Left" VerticalAlignment="Center" Width="60"/>
                            <TextBox Name="txtEdgeCount" Text="1000" Width="60" HorizontalAlignment="Left"/>
                        </DockPanel>
                        <Button Name="btnGenerate" Content="Generate Graph" Margin="2,8,2,2" HorizontalAlignment="Stretch"/>
                    </StackPanel>
                </Expander>

                <!-- Viewport Culling -->
                <Expander IsExpanded="True" Header="Viewport Culling">
                    <StackPanel Margin="4">
                        <CheckBox Name="chkEnableCulling" Content="Enable Culling" IsChecked="True" Margin="2"/>
                        <DockPanel Margin="2">
                            <TextBlock Text="Margin:" DockPanel.Dock="Left" VerticalAlignment="Center" Width="60"/>
                            <TextBox Name="txtCullingMargin" Text="100" Width="60" HorizontalAlignment="Left"/>
                        </DockPanel>
                        <TextBlock Name="txtCullingStats" Text="Visible: -/-" Margin="2" FontSize="11"/>
                    </StackPanel>
                </Expander>

                <!-- Geometry Caching -->
                <Expander IsExpanded="True" Header="Geometry Caching">
                    <StackPanel Margin="4">
                        <CheckBox Name="chkEnableCaching" Content="Enable Caching" IsChecked="True" Margin="2"/>
                        <Button Name="btnInvalidateCache" Content="Invalidate All Caches" Margin="2"/>
                    </StackPanel>
                </Expander>

                <!-- Level of Detail -->
                <Expander IsExpanded="True" Header="Level of Detail">
                    <StackPanel Margin="4">
                        <CheckBox Name="chkEnableLod" Content="Enable LOD" IsChecked="True" Margin="2"/>
                        <DockPanel Margin="2">
                            <TextBlock Text="Hide Arrows below:" DockPanel.Dock="Left" VerticalAlignment="Center"/>
                        </DockPanel>
                        <Slider Name="sliderArrowThreshold" Minimum="0" Maximum="1" Value="0.3" 
                                TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="2"/>
                        <TextBlock Name="txtArrowThreshold" Text="0.3" HorizontalAlignment="Center" FontSize="11"/>
                        
                        <DockPanel Margin="2,8,2,2">
                            <TextBlock Text="Hide Labels below:" DockPanel.Dock="Left" VerticalAlignment="Center"/>
                        </DockPanel>
                        <Slider Name="sliderLabelThreshold" Minimum="0" Maximum="1" Value="0.5" 
                                TickFrequency="0.1" IsSnapToTickEnabled="True" Margin="2"/>
                        <TextBlock Name="txtLabelThreshold" Text="0.5" HorizontalAlignment="Center" FontSize="11"/>
                    </StackPanel>
                </Expander>

                <!-- Edge Throttling -->
                <Expander IsExpanded="True" Header="Edge Throttling">
                    <StackPanel Margin="4">
                        <DockPanel Margin="2">
                            <TextBlock Text="Throttle (ms):" DockPanel.Dock="Left" VerticalAlignment="Center" Width="80"/>
                            <TextBox Name="txtThrottleMs" Text="16" Width="50" HorizontalAlignment="Left"/>
                        </DockPanel>
                        <TextBlock Text="(0 = disabled, 16 = 60fps)" FontSize="10" Margin="2" Foreground="Gray"/>
                    </StackPanel>
                </Expander>

                <!-- Actions -->
                <Expander IsExpanded="True" Header="Test Actions">
                    <StackPanel Margin="4">
                        <Button Name="btnUpdateAllEdges" Content="Update All Edges" Margin="2"/>
                        <Button Name="btnMoveRandom" Content="Move 50 Random Vertices" Margin="2"/>
                        <Button Name="btnBatchMove" Content="Batch Move 50 Vertices" Margin="2"/>
                        <Button Name="btnZoomToFit" Content="Zoom to Fit" Margin="2"/>
                    </StackPanel>
                </Expander>

                <!-- Current Zoom -->
                <Border BorderBrush="{DynamicResource ButtonBorder}" BorderThickness="1" Margin="2,8,2,2" Padding="4">
                    <StackPanel>
                        <TextBlock Text="Current Zoom" FontWeight="Bold" HorizontalAlignment="Center"/>
                        <TextBlock Name="txtCurrentZoom" Text="1.0" HorizontalAlignment="Center" FontSize="14"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
